<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="declared">
<title>c. Weighting (declared) values • declared</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="c. Weighting (declared) values">
<meta property="og:description" content="declared">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">declared</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.25</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dusadrian/declared/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>c. Weighting (declared) values</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dusadrian/declared/blob/HEAD/vignettes/c_Weighting.Rmd" class="external-link"><code>vignettes/c_Weighting.Rmd</code></a></small>
      <div class="d-none name"><code>c_Weighting.Rmd</code></div>
    </div>

    
    
<p>For the examples in this vignette, the following data frame is
created:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dusadrian/declared" class="external-link">declared</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1234</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Area <span class="op">=</span> <span class="fu"><a href="../reference/declared.html">declared</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.45</span>, <span class="fl">0.55</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Rural"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"Urban"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Gender <span class="op">=</span> <span class="fu"><a href="../reference/declared.html">declared</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.55</span>, <span class="fl">0.45</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Males"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"Females"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Opinion <span class="op">=</span> <span class="fu"><a href="../reference/declared.html">declared</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="cn">NA</span>, <span class="op">-</span><span class="fl">91</span><span class="op">)</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Very bad"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"Bad"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="st">"Neither"</span> <span class="op">=</span> <span class="fl">3</span>,</span>
<span>      <span class="st">"Good"</span> <span class="op">=</span> <span class="fl">4</span>, <span class="st">"Very good"</span> <span class="op">=</span> <span class="fl">5</span>, <span class="st">"Don't know"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">91</span></span>
<span>    <span class="op">)</span>,</span>
<span>    na_values <span class="op">=</span> <span class="op">-</span><span class="fl">91</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">18</span><span class="op">:</span><span class="fl">90</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  Children <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>One of the most interesting applications to make use of the declared
missing values are the tables of frequencies. The base function <code class="sourceCode r"><span class="fu">table</span>()</code> ignores
missing values by default, but they can be revealed by using the <code class="sourceCode r">useNA</code> argument:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">dfm</span><span class="op">$</span><span class="va">Opinion</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Very bad       Bad   Neither      Good Very good      &lt;NA&gt; </span></span>
<span><span class="co">#&gt;       180       170       188       171       162       363</span></span></code></pre></div>
<p>However, it does not differentiate between empty and declared missing
values. Since “Opinion” is the equivalent of a categorical variable,
this can be improved through a custom built coercion to the base <code class="sourceCode r">factor</code> class:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="../reference/drop_undeclare.html">undeclare</a></span><span class="op">(</span><span class="va">dfm</span><span class="op">$</span><span class="va">Opinion</span><span class="op">)</span><span class="op">)</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Don't know   Very bad        Bad    Neither       Good  Very good       &lt;NA&gt; </span></span>
<span><span class="co">#&gt;        180        180        170        188        171        162        183</span></span></code></pre></div>
<p>The dedicated function <code class="sourceCode r"><span class="fu">w_table</span>()</code> does the
same thing by automatically recognizing objects of class <code class="sourceCode r"><span class="st">"declared"</span></code>,
additionally printing more detailed information:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/weighted.html">w_table</a></span><span class="op">(</span><span class="va">dfm</span><span class="op">$</span><span class="va">Opinion</span>, values <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 fre    rel   per   vld   cpd</span></span>
<span><span class="co">#&gt;                -----------------------------</span></span>
<span><span class="co">#&gt;   Very bad   1  180  0.146  14.6  20.7  20.7 </span></span>
<span><span class="co">#&gt;        Bad   2  170  0.138  13.8  19.5  40.2 </span></span>
<span><span class="co">#&gt;    Neither   3  188  0.152  15.2  21.6  61.8 </span></span>
<span><span class="co">#&gt;       Good   4  171  0.139  13.9  19.6  81.4 </span></span>
<span><span class="co">#&gt;  Very good   5  162  0.131  13.1  18.6 100.0 </span></span>
<span><span class="co">#&gt;          ------</span></span>
<span><span class="co">#&gt; Don't know -91  180  0.146  14.6 </span></span>
<span><span class="co">#&gt;             NA  183  0.148  14.8 </span></span>
<span><span class="co">#&gt;                -----------------------------</span></span>
<span><span class="co">#&gt;                1234  1.000 100.0</span></span></code></pre></div>
<p>The prefix <code class="sourceCode r">w_</code> from the function
name stands for “weighted”, this being another example of functionality
where the declared missing values play a different role than the empty,
base NA missing values.</p>
<p>It is important to differentiate between frequency weights, on one
hand, and other probability based, post-stratification weights on one
other, the later being thoroughly treated by the specialized package
<strong>survey</strong>. The <code class="sourceCode r">w_</code> family
of functions are solely dealing with frequency weights, to allow
corrections in descriptive statistics, such as the tables of frequencies
and other similar descriptive measures for both categorical and numeric
variables.</p>
<p>To exemplify, a frequency weight variable is constructed, to correct
for the distributions of gender by males and females, as well as the
theoretical distribution by residential areas differentiating between
urban and rural settlements.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Observed proportions</span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">dfm</span>, <span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">proportions</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Gender</span>, <span class="va">Area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Theoretical / population proportions:</span></span>
<span><span class="co"># 53% Rural, and 50% Females</span></span>
<span><span class="va">tp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.53</span>, <span class="fl">0.47</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">tp</span> <span class="op">/</span> <span class="va">op</span></span>
<span></span>
<span><span class="va">dfm</span><span class="op">$</span><span class="va">fweight</span> <span class="op">&lt;-</span> <span class="va">weights</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="va">dfm</span><span class="op">$</span><span class="va">Area</span> <span class="op">+</span> <span class="va">dfm</span><span class="op">$</span><span class="va">Gender</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="fl">12</span>, <span class="fl">21</span>, <span class="fl">22</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">]</span></span></code></pre></div>
<p>The updated frequency table, this time using the frequency weights,
can be constructed by passing the weights to the argument <code class="sourceCode r">wt</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">dfm</span>, <span class="fu"><a href="../reference/weighted.html">w_table</a></span><span class="op">(</span><span class="va">Opinion</span>, wt <span class="op">=</span> <span class="va">fweight</span>, values <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 fre    rel   per   vld   cpd</span></span>
<span><span class="co">#&gt;                -----------------------------</span></span>
<span><span class="co">#&gt;   Very bad   1  179  0.145  14.5  20.5  20.5 </span></span>
<span><span class="co">#&gt;        Bad   2  167  0.135  13.5  19.2  39.7 </span></span>
<span><span class="co">#&gt;    Neither   3  187  0.152  15.2  21.4  61.1 </span></span>
<span><span class="co">#&gt;       Good   4  171  0.139  13.9  19.6  80.7 </span></span>
<span><span class="co">#&gt;  Very good   5  168  0.136  13.6  19.3 100.0 </span></span>
<span><span class="co">#&gt;          ------</span></span>
<span><span class="co">#&gt; Don't know -91  179  0.145  14.5 </span></span>
<span><span class="co">#&gt;             NA  183  0.148  14.8 </span></span>
<span><span class="co">#&gt;                -----------------------------</span></span>
<span><span class="co">#&gt;                1234  1.000 100.0</span></span></code></pre></div>
<p>Except for the empty NA values, for which the weights cannot be
applied, almost all other frequencies (including the one for the
declared missing value -91) are now updated by applying the weights.
This shows that, despite being interpreted as “missing” values, the
declared ones can and should also be weighted, with a very useful
result. Other versions of weighted frequencies do exist in R, but a
custom one was needed to identify (and weight) the declared missing
values.</p>
<p>In the same spirit, many other similar functions are provided such as
<code class="sourceCode r"><span class="fu">w_mean</span>()</code>,
<code class="sourceCode r"><span class="fu">w_var</span>()</code>, <code class="sourceCode r"><span class="fu">w_sd</span>()</code> etc., and the
list will likely grow in the future. They are similar to the base
package counterparts, with a single difference: the argument
<code>na.rm</code> is activated by default, with or without weighting.
This is an informed decision about which users are alerted in the
functions’ respective help pages.</p>
<p>The package <strong>declared</strong> was built with the specific
intention to provide a lightweight, zero dependency resource in the R
ecosystem. It contains an already extensive, robust and ready to use
functionality that duly takes into account the difference between empty
and declared missing values.</p>
<p>It extends base R and opens up data analysis possibilities without
precedent. By providing generic classes for all its objects and
functions, package <strong>declared</strong> is easily extensible to any
type of object, for both creation and coercion to class <code class="sourceCode r"><span class="st">"declared"</span></code>.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Adrian Dusa.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
