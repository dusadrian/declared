<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="declared">
<title>b. Added value • declared</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="b. Added value">
<meta property="og:description" content="declared">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">declared</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.24</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dusadrian/declared/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>b. Added value</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dusadrian/declared/blob/HEAD/vignettes/b_Added_value.Rmd" class="external-link"><code>vignettes/b_Added_value.Rmd</code></a></small>
      <div class="d-none name"><code>b_Added_value.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dusadrian/declared" class="external-link">declared</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/declared.html">declared</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">91</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Missing"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">91</span><span class="op">)</span>,</span>
<span>  na_value <span class="op">=</span> <span class="op">-</span><span class="fl">91</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The proposed method to declare missing values is unique in the R
ecosystem. Differentiating between empty and declared missing values
opens the door to a new set of challenges for which base R does not have
built-in functionality.</p>
<p>For instance, the declared missing values can be compared against
both the original values and their labels:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x2</span> <span class="op">==</span> <span class="op">-</span><span class="fl">91</span></span>
<span><span class="co">#&gt; [1] FALSE FALSE FALSE FALSE FALSE  TRUE</span></span>
<span><span class="va">x2</span> <span class="op">==</span> <span class="st">"Missing"</span></span>
<span><span class="co">#&gt; [1] FALSE FALSE FALSE FALSE FALSE  TRUE</span></span></code></pre></div>
<p>Similar methods have been added to the primitive functions <code class="sourceCode r"><span class="st">"&lt;"</span></code>,
<code class="sourceCode r"><span class="st">"&gt;"</span></code> and
<code class="sourceCode r"><span class="st">"!="</span></code>
etc., to allow a fully functional collection of subsetting
possibilities.</p>
<p>Combining on this type of vector creates an object of the same
class:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x2</span>, <span class="op">-</span><span class="fl">91</span><span class="op">)</span></span>
<span><span class="va">x2</span></span>
<span><span class="co">#&gt; &lt;declared&lt;numeric&gt;[7]&gt;</span></span>
<span><span class="co">#&gt; [1]       1       2       3       4       5 NA(-91) NA(-91)</span></span>
<span><span class="co">#&gt; Missing values: -91</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value   label</span></span>
<span><span class="co">#&gt;    -91 Missing</span></span></code></pre></div>
<p>Most functions are designed to be as similar as possible, for
instance, <code class="sourceCode r"><span class="fu">labels</span>()</code> to retrieve
or add/change value labels:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/labels.html">labels</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Does not know"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">92</span>, <span class="st">"Not responded"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">91</span><span class="op">)</span></span>
<span><span class="va">x2</span></span>
<span><span class="co">#&gt; &lt;declared&lt;numeric&gt;[7]&gt;</span></span>
<span><span class="co">#&gt; [1]       1       2       3       4       5 NA(-91) NA(-91)</span></span>
<span><span class="co">#&gt; Missing values: -91</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value         label</span></span>
<span><span class="co">#&gt;    -92 Does not know</span></span>
<span><span class="co">#&gt;    -91 Not responded</span></span></code></pre></div>
<p>The value <code>-92</code> is now properly labelled, and can further
be declared missing. Such declarations do not necessarily have to use
the main function <code class="sourceCode r"><span class="fu">declared</span>()</code>, due to
the separate functions <code class="sourceCode r"><span class="fu">missing_values</span>()</code> and
<code class="sourceCode r"><span class="fu">missing_range</span>()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/missing_values.html">missing_values</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">91</span>, <span class="op">-</span><span class="fl">92</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/missing_values.html">missing_range</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">91</span>, <span class="op">-</span><span class="fl">95</span><span class="op">)</span></span>
<span><span class="va">x2</span></span>
<span><span class="co">#&gt; &lt;declared&lt;integer&gt;[7]&gt;</span></span>
<span><span class="co">#&gt; [1]       1       2       3       4       5 NA(-91) NA(-91)</span></span>
<span><span class="co">#&gt; Missing values: -91, -92</span></span>
<span><span class="co">#&gt; Missing range:  [-95, -91]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value         label</span></span>
<span><span class="co">#&gt;    -92 Does not know</span></span>
<span><span class="co">#&gt;    -91 Not responded</span></span></code></pre></div>
<p>To ease the smooth inter-operation with packages
<strong>haven</strong> and <strong>labelled</strong>, the following
functions are of interest: <code class="sourceCode r"><span class="fu">undeclare</span>()</code>, <code class="sourceCode r"><span class="fu">as.haven</span>()</code> and <code class="sourceCode r"><span class="fu">as.declared</span>()</code>.</p>
<p>The function <code class="sourceCode r"><span class="fu">undeclare</span>()</code> replaces
the NAs with their declared missing values. The result is still an
object of class <code class="sourceCode r"><span class="st">"declared"</span></code>,
but all missing values (and missing range) are stripped off the vector,
and values are presented as they have been collected. All other
attributes of interest (variable and value labels) are retained and
printed accordingly. Activating the argument <code class="sourceCode r">drop</code> eliminates all classes and attributes,
returning a regular R object:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/drop_undeclare.html">undeclare</a></span><span class="op">(</span><span class="va">x2</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]   1   2   3   4   5 -91 -91</span></span></code></pre></div>
<p>The function <code class="sourceCode r"><span class="fu">as.haven</span>()</code> coerces
the resulting object to the class <code class="sourceCode r"><span class="st">"haven_labelled_spss"</span></code>,
and the function <code class="sourceCode r"><span class="fu">as.declared</span>()</code>
reverses the process:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.haven.html">as.haven</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span></span>
<span><span class="va">xh</span></span>
<span><span class="co">#&gt; &lt;labelled_spss&lt;integer&gt;[7]&gt;</span></span>
<span><span class="co">#&gt; [1]   1   2   3   4   5 -91 -91</span></span>
<span><span class="co">#&gt; Missing values: -91, -92</span></span>
<span><span class="co">#&gt; Missing range:  [-95, -91]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value         label</span></span>
<span><span class="co">#&gt;    -92 Does not know</span></span>
<span><span class="co">#&gt;    -91 Not responded</span></span>
<span></span>
<span><span class="fu"><a href="../reference/declared.html">as.declared</a></span><span class="op">(</span><span class="va">xh</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;declared&lt;integer&gt;[7]&gt;</span></span>
<span><span class="co">#&gt; [1]       1       2       3       4       5 NA(-91) NA(-91)</span></span>
<span><span class="co">#&gt; Missing values: -91, -92</span></span>
<span><span class="co">#&gt; Missing range:  [-95, -91]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value         label</span></span>
<span><span class="co">#&gt;    -92 Does not know</span></span>
<span><span class="co">#&gt;    -91 Not responded</span></span></code></pre></div>
<p>The missing values are properly formatted, even inside the base data
frame:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>, <span class="va">x2</span><span class="op">)</span></span>
<span><span class="va">dfm</span></span>
<span><span class="co">#&gt;   x1      x2</span></span>
<span><span class="co">#&gt; 1  a       1</span></span>
<span><span class="co">#&gt; 2  b       2</span></span>
<span><span class="co">#&gt; 3  c       3</span></span>
<span><span class="co">#&gt; 4  d       4</span></span>
<span><span class="co">#&gt; 5  e       5</span></span>
<span><span class="co">#&gt; 6  f NA(-91)</span></span>
<span><span class="co">#&gt; 7  g NA(-91)</span></span></code></pre></div>
<p>If users prefer a tibble instead of a data frame, the objects of
class “<code class="sourceCode r">declared<span class="st">"</span></code> are
properly formatted in a similar way to those from package
<strong>haven</strong>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">dfm</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 2</span></span></span>
<span><span class="co">#&gt;   x1    x2                      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int+lbl&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> a       1                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> b       2                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> c       3                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> d       4                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> e       5                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> f     -<span style="color: #BB0000;">91 (NA)</span><span style="color: #949494;"> [Not responded]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> g     -<span style="color: #BB0000;">91 (NA)</span><span style="color: #949494;"> [Not responded]</span></span></span></code></pre></div>
<p>Special challenges are associated with sorting and ordering the
declared objects, where not all missing values are treated the same.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/declared.html">declared</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">91</span>, <span class="cn">NA</span>, <span class="op">-</span><span class="fl">92</span>, <span class="op">-</span><span class="fl">91</span><span class="op">)</span>,</span>
<span>  na_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">92</span>, <span class="op">-</span><span class="fl">91</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">x3</span>, na.last <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;declared&lt;integer&gt;[9]&gt;</span></span>
<span><span class="co">#&gt; [1]       1       2       3       4       5 NA(-92) NA(-91) NA(-91)      NA</span></span>
<span><span class="co">#&gt; Missing values: -92, -91</span></span></code></pre></div>
<p>Sorting in decreasing order applies the same order to the missing
values:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">x3</span>, na.last <span class="op">=</span> <span class="cn">TRUE</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;declared&lt;integer&gt;[9]&gt;</span></span>
<span><span class="co">#&gt; [1]       5       4       3       2       1 NA(-91) NA(-91) NA(-92)      NA</span></span>
<span><span class="co">#&gt; Missing values: -92, -91</span></span></code></pre></div>
<p>This custom function benefits from an additional argument <code class="sourceCode r">empty.last</code> (internally passed to the
ordering function), to allow sorting within the missing values:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">x3</span>, na.last <span class="op">=</span> <span class="cn">TRUE</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span>, empty.last <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;declared&lt;integer&gt;[9]&gt;</span></span>
<span><span class="co">#&gt; [1]       5       4       3       2       1      NA NA(-91) NA(-91) NA(-92)</span></span>
<span><span class="co">#&gt; Missing values: -92, -91</span></span></code></pre></div>
<p>All types of variables (categorical and numerical) can have declared
missing values. There are situations when values are not missing
randomly but with a specific reason. In social research, respondents
often can not or do not want to provide an answer for a certain
question, be it categories of opinions or pure numerical answers like
age, income, etc.</p>
<p>Base R has a clear distinction between numerical and categorical
variables. For the latter, R provides a special type of object called
<code class="sourceCode r">factor</code>. The following object simulates
such a categorical variable, for instance political orientation:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/declared.html">declared</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">91</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Left"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"Middle"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="st">"Right"</span> <span class="op">=</span> <span class="fl">3</span>, <span class="st">"Apolitic"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">91</span><span class="op">)</span>,</span>
<span>  na_value <span class="op">=</span> <span class="op">-</span><span class="fl">91</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"Respondent's political orientation"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x4</span></span>
<span><span class="co">#&gt; &lt;declared&lt;numeric&gt;[4]&gt; Respondent's political orientation</span></span>
<span><span class="co">#&gt; [1]       1       2       3 NA(-91)</span></span>
<span><span class="co">#&gt; Missing values: -91</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value    label</span></span>
<span><span class="co">#&gt;      1     Left</span></span>
<span><span class="co">#&gt;      2   Middle</span></span>
<span><span class="co">#&gt;      3    Right</span></span>
<span><span class="co">#&gt;    -91 Apolitic</span></span></code></pre></div>
<p>Such a variable could in principle be constructed directly as a
factor:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Left"</span>, <span class="st">"Middle"</span>, <span class="st">"Right"</span>, <span class="st">"Apolitic"</span><span class="op">)</span>,</span>
<span>  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Left"</span>, <span class="st">"Middle"</span>, <span class="st">"Right"</span>, <span class="st">"Apolitic"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x5</span></span>
<span><span class="co">#&gt; [1] Left     Middle   Right    Apolitic</span></span>
<span><span class="co">#&gt; Levels: Left Middle Right Apolitic</span></span></code></pre></div>
<p>The base factors provide no possibility to assign specific values for
the specific categories, and most importantly, they do not differentiate
between valid values and (declared) missing values. To make the
functionality consistent with the base treatment of <code>NA</code>
values, coercing to factors defaults to dropping the declared missing
values because of the default value of the argument <code class="sourceCode r">drop_na</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">x4</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Left   Middle Right  &lt;NA&gt;  </span></span>
<span><span class="co">#&gt; Levels: Left Middle Right</span></span>
<span></span>
<span><span class="co"># essentially acting as:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="../reference/drop_undeclare.html">drop_na</a></span><span class="op">(</span><span class="va">x4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Left   Middle Right  &lt;NA&gt;  </span></span>
<span><span class="co">#&gt; Levels: Left Middle Right</span></span></code></pre></div>
<p>Converting the declared missing values to factor levels is something
for which the function <code class="sourceCode r"><span class="fu">undeclare</span>()</code> proves
useful, and switching between factors and declared objects, preserving
the declared missing values, is now straightforward:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="../reference/drop_undeclare.html">undeclare</a></span><span class="op">(</span><span class="va">x4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Left     Middle   Right    Apolitic</span></span>
<span><span class="co">#&gt; Levels: Apolitic Left Middle Right</span></span></code></pre></div>
<p>This is almost identical, but differs from <code>x5</code> with
respect to the level orders. It happens because the missing value -91,
coerced to a valid value, becomes the first in the order of the
categories while normally, a categorical variable displays the valid
values first, and the missing values last.</p>
<p>If the original order is important, the argument <code>drop_na</code>
can be deactivated:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">x4</span>, drop_na <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Left     Middle   Right    Apolitic</span></span>
<span><span class="co">#&gt; Levels: Left Middle Right Apolitic</span></span></code></pre></div>
<p>The reverse process is also possible, to convert / coerce factors to
declared labelled objects:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/declared.html">as.declared</a></span><span class="op">(</span><span class="va">x5</span>, na_values <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;declared&lt;numeric&gt;[4]&gt;</span></span>
<span><span class="co">#&gt; [1]     1     2     3 NA(4)</span></span>
<span><span class="co">#&gt; Missing values: 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value    label</span></span>
<span><span class="co">#&gt;      1     Left</span></span>
<span><span class="co">#&gt;      2   Middle</span></span>
<span><span class="co">#&gt;      3    Right</span></span>
<span><span class="co">#&gt;      4 Apolitic</span></span></code></pre></div>
<p>When the declared objects are constructed as categorical variables to
replace the base factors, the function <code class="sourceCode r"><span class="fu">as.character</span>()</code>
extracts the categories in a similar way to factors, via a dedicated
class method for declared objects:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">x4</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Left"   "Middle" "Right"  NA</span></span></code></pre></div>
<p>Similarly, the function <code class="sourceCode r"><span class="fu">as.character</span>()</code> drops
the declared missing values by default, something that can be prevented
by either of the following two commands:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="../reference/drop_undeclare.html">undeclare</a></span><span class="op">(</span><span class="va">x4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Left"     "Middle"   "Right"    "Apolitic"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">x4</span>, drop_na <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Left"     "Middle"   "Right"    "Apolitic"</span></span></code></pre></div>
<p>The base factors store the categories using numeric values, which is
also the most often scenario for the declared objects. But this is not
at all mandatory, as the declared objects are also able to ingest
character vectors:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/declared.html">declared</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"z"</span><span class="op">)</span>,</span>
<span>    <span class="fl">20</span>,</span>
<span>    replace <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Left"</span> <span class="op">=</span> <span class="st">"a"</span>, <span class="st">"Middle"</span> <span class="op">=</span> <span class="st">"b"</span>, <span class="st">"Right"</span> <span class="op">=</span> <span class="st">"c"</span>, <span class="st">"Apolitic"</span> <span class="op">=</span> <span class="st">"z"</span><span class="op">)</span>,</span>
<span>  na_values <span class="op">=</span> <span class="st">"z"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x6</span></span>
<span><span class="co">#&gt; &lt;declared&lt;character&gt;[20]&gt;</span></span>
<span><span class="co">#&gt;  [1]    b     c  NA(z)    b  NA(z) NA(z)    b     a     c  NA(z) NA(z)    b </span></span>
<span><span class="co">#&gt; [13]    b     c     b     c     b     b     a  NA(z)</span></span>
<span><span class="co">#&gt; Missing values: z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value    label</span></span>
<span><span class="co">#&gt;      a     Left</span></span>
<span><span class="co">#&gt;      b   Middle</span></span>
<span><span class="co">#&gt;      c    Right</span></span>
<span><span class="co">#&gt;      z Apolitic</span></span></code></pre></div>
<p>Either as a character, numeric or categorical, it is possible to
declare and use special types of missing values, employing this new
object type of class <code class="sourceCode r"><span class="st">"declared"</span></code>.</p>
<p>Factors and <code class="sourceCode r">haven</code> objects have
default coercion methods, but not all types of objects can be
automatically coerced to this class. To meet this possibility, the main
functions <code class="sourceCode r"><span class="fu">declared</span>()</code>, <code class="sourceCode r"><span class="fu">as.declared</span>()</code>, <code class="sourceCode r"><span class="fu">undeclare</span>()</code> and
<code class="sourceCode r"><span class="fu">drop_na</span>()</code> are
all generic, allowing full flexibility for any other packages to create
custom (coercion) methods for different object classes, thus
facilitating and encouraging a widespread use.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Adrian Dusa.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
