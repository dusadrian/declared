<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="declared">
<title>a. Motivation for the declared package • declared</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="a. Motivation for the declared package">
<meta property="og:description" content="declared">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">declared</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.25</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dusadrian/declared/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>a. Motivation for the declared package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dusadrian/declared/blob/HEAD/vignettes/a_Declared_solution.Rmd" class="external-link"><code>vignettes/a_Declared_solution.Rmd</code></a></small>
      <div class="d-none name"><code>a_Declared_solution.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dusadrian/declared" class="external-link">declared</a></span><span class="op">)</span></span></code></pre></div>
<p>The R ecosystem already has some very good packages that deal with
labelled objects. In particular, the inter-connected packages
<strong>haven</strong> and <strong>labelled</strong> provide all the
functionality most users would ever need.</p>
<p>As nice and useful as these packages are, it has become apparent they
have some fundamental design features that run, in some situations,
against users’ expectations. This often relates to the treatment of
declared missing values that are instrumental for the social
sciences.</p>
<p>The following minimal example (adapted from the vignette in package
<strong>haven</strong>) illustrates the situation:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org" class="external-link">haven</a></span><span class="op">)</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/labelled_spss.html" class="external-link">labelled_spss</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">91</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Missing"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">91</span><span class="op">)</span>,</span>
<span>  na_value <span class="op">=</span> <span class="op">-</span><span class="fl">91</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The printed objects from this package nicely display some
properties:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x1</span></span>
<span><span class="co">#&gt; &lt;labelled_spss&lt;double&gt;[6]&gt;</span></span>
<span><span class="co">#&gt; [1]   1   2   3   4   5 -91</span></span>
<span><span class="co">#&gt; Missing values: -91</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value   label</span></span>
<span><span class="co">#&gt;    -91 Missing</span></span></code></pre></div>
<p>There are 5 normal (non-missing) values (supposedly, they represent
the number of children), and one declared missing value coded
<code>-91</code>. This value <em>acts</em> as a missing value, but it is
different from a regular missing value in R, coded <code>NA</code>. The
latter stands for any missing information (something like an empty cell)
regardless of the reason.</p>
<p>On the other hand, the cell is <em>not</em> empty, but the value
<code>-91</code> is not a valid value either. It cannot possibly
represent -91 children in the household, but for instance, it could have
meant the respondent did not want to respond. It is properly identified
as missing with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE FALSE FALSE FALSE FALSE  TRUE</span></span></code></pre></div>
<p>But when calculating a mean, for instance, the normal expectation is
that value <code>-91</code> would not play any role in the calculations
(since it should be <em>missing</em>). However:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -12.66667</span></span></code></pre></div>
<p>This means the value <code>-91</code> did play an active role despite
being identified as “missing”. In an ideal world, the expected mean
would be 3, or at best, employ the argument <code class="sourceCode r">na.rm <span class="ot">=</span> <span class="cn">TRUE</span></code>
if the result is <code>NA</code> because of the declared missing
value.</p>
<p>A solution to this problem is offered by package
<strong>labelled</strong>, which has a function called <code class="sourceCode r"><span class="fu">user_na_to_na</span>()</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://larmarange.github.io/labelled/" class="external-link">labelled</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://larmarange.github.io/labelled/reference/na_values.html" class="external-link">user_na_to_na</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>A similar behavior is observed into another package
<strong>memisc</strong>, that also deals with labels and missing
values:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://memisc.elff.eu" class="external-link">memisc</a></span><span class="op">)</span></span>
<span><span class="va">memx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">91</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/labels.html">labels</a></span><span class="op">(</span><span class="va">memx</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Missing"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">91</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://melff.github.io/memisc/reference/value-filters.html" class="external-link">missing.values</a></span><span class="op">(</span><span class="va">memx</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">91</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">memx</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -12.66667</span></span></code></pre></div>
<p>Here too, despite being declared as missing, the value
<code>-91</code> still plays a role in calculating the mean. It has to
be coerced to numeric to really convert that value to
<code>NA</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">memx</span><span class="op">)</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<div class="section level2">
<h2 id="the-declared-solution">The declared solution<a class="anchor" aria-label="anchor" href="#the-declared-solution"></a>
</h2>
<p>While solving the problem, the above solutions force two additional
operations:</p>
<ul>
<li><p>converting the (already) declared user missing values,
and</p></li>
<li><p>employing the <code>na.rm</code> argument.</p></li>
</ul>
<p>This should not be necessary, especially if (and it is extremely
likely that) users may forget the declared missing values are not
actually missing values. This scenario is quite possible, as many users
previously using other software like SPSS or Stata where nothing else
should be done after declaring the missing values may not realize more
is needed.</p>
<p>To solve this problem, the <strong>declared</strong> package creates
a similar object, where declared missing values are stored (hence
interpreted as) regular <code>NA</code> missing values in R.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dusadrian/declared" class="external-link">declared</a></span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/declared.html">declared</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">91</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Missing"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">91</span><span class="op">)</span>,</span>
<span>  na_value <span class="op">=</span> <span class="op">-</span><span class="fl">91</span></span>
<span><span class="op">)</span></span>
<span><span class="va">x2</span></span>
<span><span class="co">#&gt; &lt;declared&lt;numeric&gt;[6]&gt;</span></span>
<span><span class="co">#&gt; [1]       1       2       3       4       5 NA(-91)</span></span>
<span><span class="co">#&gt; Missing values: -91</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value   label</span></span>
<span><span class="co">#&gt;    -91 Missing</span></span></code></pre></div>
<p>The print method makes it obvious the value <code>-91</code> is not a
regular number but an actual missing value. More importantly, this type
of storage circumvents the need to convert user-defined missing values
to regular <code>NA</code> values since they are already stored as
regular <code>NA</code> values. The average value is calculated simply
as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>Notice that neither <code class="sourceCode r"><span class="fu">user_na_to_na</span>()</code>, nor
employing <code class="sourceCode r">na.rm <span class="ot">=</span> <span class="cn">TRUE</span></code>
are necessary, and, despite being stored as an <code>NA</code> value,
the value <code>-91</code> is not equivalent to an <em>empty cell</em>.
The information still exists, but it is simply ignored in the
calculations.</p>
<p>At first glance, providing a class method for this function seems
unnecessary because activating the argument <code>na.rm</code> will
return the correct result. Explaining the importance of the class method
requires a discussion about the base R decision to have this argument
deactivated by default. This is most likely to alert users about
possible problems in the data since a default value of <code>TRUE</code>
would obscure such problems; the mean is calculated irrespective of
potentially problematic <code>NA</code> values.</p>
<p>This is where differentiating between empty and declared missing
values proves valuable. The declared missing values are neither
problematic nor signal potential problems in the data, given that once a
reason is declared, it is already known why a particular value is
missing.</p>
<p>The genuinely problematic values are the empty <code>NA</code>
values, and the custom class method still allows identifying such values
if they exist:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x2</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x2</span>, <span class="cn">NA</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>Since all declared values are stored as regular NA values, the base
function <code class="sourceCode r"><span class="fu">is.na</span>()</code>, as well as
all related functions such as <code class="sourceCode r"><span class="fu">anyNA</span>()</code> etc., are
unaware and can not differentiate between empty and declared missing
values:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x2</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE</span></span></code></pre></div>
<p>To overcome this situation, package <strong>declared</strong>
complementary provides an additional function to account for the
difference:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/is.empty.html">is.empty</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x2</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE</span></span></code></pre></div>
<p>All missing values, empty and declared, play well with the NA
oriented, base functions such as <code class="sourceCode r"><span class="fu">na.omit</span>()</code> or <code class="sourceCode r"><span class="fu">na.exclude</span>()</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;declared&lt;numeric&gt;[5]&gt;</span></span>
<span><span class="co">#&gt; [1] 1 2 3 4 5</span></span>
<span><span class="co">#&gt; Missing values: -91</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value   label</span></span>
<span><span class="co">#&gt;    -91 Missing</span></span></code></pre></div>
<p>It should be made obvious the excellent packages
<strong>memisc</strong>, <strong>haven</strong> and
<strong>labelled</strong> are not inherently doing a bad thing: the very
same result is obtained, just via a different route. Package
<strong>declared</strong> was created as an alternative to the design
philosophy of these packages, with a fundamental difference: instead of
interpreting existing values as missing, the missing values are
interpreted as existing.</p>
<p>It does so by storing an additional attribute containing the
positions (indexes) of the regular <code>NA</code> values in the object,
which should be treated as missing, and, even more so, to be interpreted
as a particular missing response category, as specified in the value
labels attribute.</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Adrian Dusa.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
